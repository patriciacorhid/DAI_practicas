\documentclass{article}
\usepackage[left=1.8cm,right=3cm,top=2cm,bottom=2cm]{geometry} % page
% settings
\usepackage{multicol} 
\usepackage{amsmath} % provides many mathematical environments & tools
\usepackage{dsfont}
\usepackage{upgreek}
\usepackage[spanish]{babel}
\usepackage[doument]{ragged2e}

% Images
\usepackage{graphicx}
\usepackage{float}
\usepackage{subfigure} % subfiguras
\usepackage{caption}
\captionsetup[table]{labelformat=empty}
\captionsetup[figure]{labelformat=empty}

% Code
\usepackage{tikz}
\usetikzlibrary{automata,positioning}
\usepackage{pgfplots}
\usepackage{color}

\usepackage{listings}
\usepackage{xcolor}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\newcommand{\n}[1]{{\color{gray}#1}}
\lstset{numbers=left,numberstyle=\small\color{gray}}

\usepackage[bookmarks=true,
            bookmarksnumbered=false, % true means bookmarks in 
                                     % left window are numbered
            bookmarksopen=false,     % true means only level 1
                                     % are displayed.
            colorlinks=true,
            allcolors=blue,
            urlcolor=cyan]{hyperref}

\selectlanguage{spanish}
\usepackage[utf8]{inputenc}
\setlength{\parindent}{0mm}

\begin{document}

\title{Práctica 10}
\author{Patricia Córdoba Hidalgo}
\date{}
\maketitle

\section{Objetivos}

Mi objetivo en esta práctica es añadir las siguientes funcionalidades a la página creada en la Práctica 5:
\begin{itemize}
\item Añadir una cartelera con una serie de películas recomendadas, a la que se accederá mediante el botón \texttt{Peliculas recomendadas} situado en la barra de navegación.
\item Añadir gráficas utilizando Highcharts. Podemos visualizarlas pulsando en la sección \texttt{Estadísticas} de la barra de navegación.
\end{itemize}

\section{Desarrollo}

\subsection{Cartelera}

El fichero \texttt{html} donde se despliega esta funcionalidad es \textit{recomendadas.html}, que extiende del fichero \textit{p4.html}, el fichero base. Este fichero contiene en el bloque \textit{lista} el código para crear una sección donde se encontrará tanto la imagen de una de las películas recomendadas como dos enlaces a cada lado de esta imagen, uno a su izquierda para ver al poster de la película anterior y otro a su derecha para ver el de la siguiente.\\

La imagen por defecto incluida en esta sección es el poster de la película \textit{West Side Story}, y se cambiará al pulsar los enlaces de \texttt{Previa} y \texttt{Siguiente}. Los códigos de las funciones que se ejecutan al pulsar en dichos enlaces, \texttt{prev()} y \texttt{next()}, se encuentran en el fichero \textit{src.js}, en la carpeta \textit{static}.\\

Para que se ejecuten las funciones definidas en el fichero \textit{src.js} hay que incluir la siguiente línea en \textit{p4.html}:
\begin{center}
  \texttt{<script src=``{{url\_for('static', filename='src.js')}}''></script>}
\end{center}

En este fichero, tras el código para cambiar al modo nocturno, programé las funciones que permiten deslizar las imágenes de la cartelera. Primero declaré el vector \texttt{images}, que contiene la dirección donde se encuentran los pósters de todas las películas que forman la cartelera, y la variable \texttt{num}, que señala cual de las imágenes del vector se está mostrando en ese momento. Las funciones \texttt{prev()} y \texttt{next()} actualizan el valor de \texttt{num}, decrementando e incrementando su valor módulo \texttt{images.length} respectivamente, para que se muestre la imagen del vector \texttt{images} situada en esa posición.

\subsection{Gráficas}

Primero instalamos Highcharts añadiendo en la cabecera de \textit{p4.html} la línea:
\vspace{-1mm}
\begin{center}
  \texttt{<script src=``https://code.highcharts.com/highcharts.js''></script>}
\end{center}

como indica en \href{https://www.highcharts.com/docs/getting-started/installation}{la documentación}.\\

En el fichero \textit{graficas.html} creamos las secciones que albergarán los dos gráficos de la página e introducimos el código de éstas. Estas gráficas las implementé inspirándome en los códigos que aparecen en \href{https://www.highcharts.com/docs/getting-started/your-first-chart}{https://www.highcharts.com/docs/\\getting-started/your-first-chart} y en \href{https://www.highcharts.com/demo/pie-semi-circle}{https://www.highcharts.com/demo/pie-semi-circle}.\\

Al final del fichero \textit{src.js} está el código donde se declara el estilo de las gráficas. En los enlaces \href{https://www.highcharts.com/docs/getting-started/how-to-set-options}{https://www.highcharts.com/\\docs/getting-started/how-to-set-options} encontramos un ejemplo del uso de \texttt{setOptions}, el método que utilicé para especificar el estilo de mis gráficas.

La información que se representa en las gráficas se recopila en la función \texttt{graficas()} del fichero \textit{app.py}, la última función definida en este fichero.

\section{Alternativas}

\section{Problemas y sus soluciones}

Para calcular el año máximo y mínimo usamos la función sort como nos indica la documentación:
https://docs.mongodb.com/manual/reference/method/cursor.sort/

La línea de código de la función gráficas:
max_year = db.video_movies.find().sort({'year':-1})[0]['year']

producía el siguiente error:
if no direction is specified, key_or_list must be an instance of list

Tras consultar el siguiente enlace:
https://stackoverflow.com/questions/10242149/using-sort-with-pymongo

descubrimos que la manera correcta es:
max_year = db.video_movies.find().sort([('year',-1)])[0]['year']





\end{document}